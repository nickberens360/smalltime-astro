---
import { getPrintifyData } from '../lib/printify';
import Layout from '../layouts/Layout.astro';

// This helper function converts a shop title into a URL-friendly slug
const toSlug = (str) => str.toLowerCase().replace(/\s+/g, '-');

// Fetch all shops directly from the Printify API
const shopsResponse = await getPrintifyData();
const shops = shopsResponse.success ? shopsResponse.data : [];
---
<Layout title="All Categories">
  <div class="category-list-container">
    <h1>All Categories</h1>
    <p>Select a category to view products.</p>

    {shops.length > 0 ? (
        <ul class="category-list">
          {shops.map(shop => {
            const categoryUrl = `/category/${toSlug(shop.title)}`;
            return (
                <li>
                  <a href={categoryUrl} class="category-link">{shop.title}</a>
                </li>
            )
          })}
        </ul>
    ) : (
        <p class="error-message">
          Could not load categories. Please ensure your PRINTIFY_API_TOKEN is correct.
        </p>
    )}
  </div>
</Layout>

<style>
  .category-list-container {
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
  }
  .category-list {
    list-style: none;
    padding: 0;
    margin-top: 2rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
  }
  .category-link {
    display: block;
    padding: 1.5rem;
    background-color: #fff;
    border: 1px solid #eee;
    border-radius: 8px;
    text-align: center;
    text-decoration: none;
    color: #333;
    font-weight: 600;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .category-link:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .error-message {
    color: #991b1b;
    background-color: #fef2f2;
    padding: 1rem;
    border-radius: 8px;
  }
</style>